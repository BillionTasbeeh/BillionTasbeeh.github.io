<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Billion Tasbeeh - Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');
        
        :root {
            --main-color: #27ae60;
            --secondary-color: #2c3e50;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-color: #fff;
            --progress-color: #e74c3c;
            --counter-color: #2c3e50;
            --dark-mode: false;
        }

        [data-theme="dark"] {
            --main-color: #2ecc71;
            --secondary-color: #ecf0f1;
            --text-color: #ecf0f1;
            --bg-color: #2c3e50;
            --card-color: #34495e;
            --progress-color: #f39c12;
            --counter-color: #ecf0f1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            position: relative;
            transition: background-color 0.3s, color 0.3s;
            touch-action: manipulation;
        }
        
        .floating-shapes {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 15s infinite linear;
        }
        
        .shape:nth-child(1) {
            top: 10%;
            left: 10%;
            width: 40px;
            height: 40px;
            background-color: #3498db;
            border-radius: 50%;
            animation-delay: 0s;
        }
        
        .shape:nth-child(2) {
            top: 70%;
            left: 80%;
            width: 50px;
            height: 50px;
            background-color: #e74c3c;
            border-radius: 50%;
            animation-delay: 3s;
        }
        
        .shape:nth-child(3) {
            top: 30%;
            left: 60%;
            width: 45px;
            height: 45px;
            background-color: #2ecc71;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            animation-delay: 6s;
        }
        
        .shape:nth-child(4) {
            top: 80%;
            left: 30%;
            width: 60px;
            height: 30px;
            background-color: #f39c12;
            border-radius: 15px;
            animation-delay: 9s;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
            }
        }
        
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 15px;
            max-width: 100%;
            margin: 0 auto;
            position: relative;
        }
        
        .app-header {
            text-align: center;
            margin: 12px 0 20px;
        }
        
        .app-title {
            font-size: 2.5rem;
            color: var(--main-color);
            margin: 0;
            font-weight: 700;
            line-height: 1.5;
        }
        
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        
        .theme-btn, .lang-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-color);
            cursor: pointer;
            padding: 5px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .counter-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .counter-value {
            font-size: 2.48rem;
            font-weight: bold;
            font-family: 'Roboto Mono', monospace;
            color: var(--main-color);
            direction: ltr;
            letter-spacing: 1px;
            transition: color 0.3s;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        
        .dhikr-section {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 5px 0;
            position: relative;
        }
        
        .dhikr-text {
            font-size: 3rem;
            color: var(--secondary-color);
            margin: 20px 0;
            text-align: center;
            display: flex;
            align-items: center;
            position: relative;
            padding: 0 30px;
            min-height: 3.5rem; /* To avoid layout shift if text is empty initially */
        }
        
        .edit-dhikr {
            font-size: 1.2rem;
            position: absolute;
            left: 0;
            cursor: pointer;
            color: #7f8c8d;
            transition: all 0.2s;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .edit-dhikr:active {
            transform: scale(0.9);
            color: var(--main-color);
        }
        
        .main-button {
            background: linear-gradient(135deg, var(--main-color) 0%, #2ecc71 100%);
            color: white;
            border: none;
            width: 160px;
            height: 160px;
            border-radius: 50%;
            font-size: 1.4rem;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.3);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        
        .main-button:active {
            transform: scale(0.96);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        .progress-container {
            width: 100%;
            height: 6px;
            background-color: rgba(0,0,0,0.1);
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--progress-color), #f39c12);
            width: 0%;
            transition: width 0.5s;
        }
        
        .settings-bar {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background-color: var(--card-color);
            border-radius: 50px;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
            margin-top: auto;
        }
        
        .settings-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            opacity: 0.8;
            transition: all 0.2s;
            color: var(--text-color);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .settings-btn:active {
            transform: scale(0.9);
            opacity: 1;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }
        
        .modal-content {
            background-color: var(--card-color);
            color: var(--text-color);
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalFade 0.3s;
        }
        
        .welcome-modal {
            text-align: center;
        }
        .welcome-modal-lang-switcher {
            text-align: right;
            margin-bottom: 10px;
        }
        .welcome-modal-lang-switcher .btn {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
         .welcome-modal-lang-switcher .btn.selected {
            background-color: var(--secondary-color);
            color: var(--bg-color);
        }

        .dhikr-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 12px 0;
        }
        
        .dhikr-option {
            padding: 12px;
            background-color: rgba(0,0,0,0.1);
            border-radius: 8px;
            text-align: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dhikr-option:active {
            background-color: rgba(0,0,0,0.2);
        }
        
        .dhikr-option.selected {
            background-color: var(--main-color);
            color: white;
        }
        
        .lang-option {
            padding: 12px;
            background-color: rgba(0,0,0,0.1);
            border-radius: 8px;
            text-align: center;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .lang-option:active {
            background-color: rgba(0,0,0,0.2);
        }
        
        .lang-option.selected {
            background-color: var(--main-color);
            color: white;
        }
        
        .btn {
            background-color: var(--main-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            margin: 8px 5px 0;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-secondary {
            background-color: #7f8c8d;
        }
        
        .section-title {
            margin: 1px 0 8px;
            color: var(--main-color);
            font-size: 1.5rem; 
        }
        
        .terms-text {
            max-height: 250px; /* Increased height for full policy */
            overflow-y: auto;
            padding: 8px;
            background-color: rgba(0,0,0,0.05);
            border-radius: 8px;
            margin: 8px 0;
            text-align: start;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .terms-text h3, .terms-text h4 { /* Style policy headings */
            color: var(--main-color);
            margin-top: 10px;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        .terms-text p {
            margin-bottom: 8px;
        }
        .terms-text ul {
            list-style-position: inside;
            padding-right: 20px; /* For RTL */
            margin-bottom: 8px;
        }
        [dir="ltr"] .terms-text ul {
            padding-right: 0;
            padding-left: 20px;
        }
        .terms-text li {
            margin-bottom: 4px;
        }
        .terms-text a {
            color: var(--main-color);
            text-decoration: none;
        }
        .terms-text a:hover {
            text-decoration: underline;
        }

        
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            font-family: 'Tajawal', sans-serif;
            font-size: 0.9rem;
        }
        
        @keyframes modalFade {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (min-width: 500px) {
            .app-container {
                max-width: 500px;
            }
            
            .app-title {
                font-size: 2.2rem;
            }
            
            .counter-value {
                font-size: 2.15rem;
            }
            
            .dhikr-text {
                font-size: 2.5rem;
            }
            
            .main-button {
                width: 140px;
                height: 140px;
                font-size: 1.2rem;
            }
        }
        
        @media (min-height: 700px) {
            .app-title {
                font-size: 2.2rem;
            }
            
            .counter-value {
                font-size: 3rem;
            }
            
            .dhikr-text {
                font-size: 2.8rem;
            }
            
            .main-button {
                width: 140px;
                height: 140px;
                font-size: 1.2rem;
            }
        }
        #welcomeText { 
            /* color: var(--text-color); Removed specific color to allow span styling */
            font-size: 1rem; 
            font-weight: normal; 
            margin-bottom: 10px; 
            line-height: 1.5;
        }

        #infoWelcomeText1 { 
            color: var(--text-color);
            font-size: 1rem; 
            font-weight: normal;
        }

        #infoWelcomeText2 { 
            color: var(--main-color);
            font-size: 1rem; 
            font-weight: bold;
        }

        #infoContactText1 { 
            color: var(--text-color);
            font-size: 1rem; 
            font-weight: normal;
        }
        #infoContactText1 a {
            color: var(--main-color);
        }
    </style>
</head>
<body>
    <!-- Floating Shapes -->
    <div class="floating-shapes">
        <div class="shape"></div><div class="shape"></div><div class="shape"></div><div class="shape"></div>
    </div>
    
    <!-- Welcome Modal -->
    <div class="modal" id="welcomeModal">
        <div class="modal-content welcome-modal">
            <div id="welcomeTermsSection">
                <div class="welcome-modal-lang-switcher">
                    <button class="btn" id="welcomeLangAr">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                    <button class="btn" id="welcomeLangEn">English</button>
                </div>
                <h2 class="section-title" id="welcomeTitle">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©</h2>
                <p id="welcomeText">Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ØªØ³Ø¨ÙŠØ­ Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰...</p>
                <h3 class="section-title" id="welcomeTermsTitle">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø´Ø±ÙˆØ·</h3>
                <div class="terms-text" id="welcomePolicyContent">
                    <!-- Policy content will be injected by JavaScript -->
                </div>
                <button class="btn" id="acceptBtn">Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·</button>
                <button class="btn btn-secondary" id="declineBtn">Ø±ÙØ¶</button>
            </div>
            <div id="initialDhikrSelectionSection" style="display: none;">
                <h2 class="section-title" id="initialDhikrTitle">Ø§Ø®ØªØ± Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ø°ÙŠ Ø³ØªØ±Ø¯Ø¯Ù‡</h2>
                <div class="dhikr-options" id="initialDhikrOptionsContainer"></div>
                <p style="font-size: 0.8rem; margin-top: 10px;" id="canChangeLaterText">ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø°ÙƒØ± Ù„Ø§Ø­Ù‚Ù‹Ø§.</p>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div class="app-container">
        <div class="app-header"><h1 class="app-title" id="appTitle">Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©</h1></div>
        <div class="toolbar">
            <button class="theme-btn" id="themeBtn">ğŸŒ™</button>
            <button class="lang-btn" id="langBtn">ğŸŒ</button>
        </div>
        <div class="counter-container"><div class="counter-value" id="counter">1,000,000,000</div></div>
        <div class="dhikr-section">
            <div class="dhikr-text">
                <span class="edit-dhikr" id="editDhikr">âœï¸</span>
                <span id="currentDhikr"></span>
            </div>
            <button class="main-button" id="mainButton">Ø§Ø¶ØºØ· Ù„Ù„Ø°ÙƒØ±</button>
            <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
        </div>
        <div class="settings-bar">
            <button class="settings-btn" id="soundBtn">ğŸ”Š</button>
            <button class="settings-btn" id="vibrationBtn">ğŸ“³</button>
            <button class="settings-btn" id="resetBtn">ğŸ”„</button>
            <button class="settings-btn" id="infoBtn">â„¹ï¸</button>
        </div>
    </div>
    
    <!-- Dhikr Modal (General) -->
    <div class="modal" id="dhikrModal">
        <div class="modal-content">
            <h2 class="section-title" id="chooseDhikrTitle">Ø§Ø®ØªØ± Ø§Ù„Ø°ÙƒØ±</h2>
            <div class="dhikr-options"></div>
            <div style="margin-top: 15px; margin-bottom: 10px;">
                <input type="text" id="customDhikrInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø°ÙƒØ± Ù‡Ù†Ø§...">
                <button class="btn" id="addCustomDhikrBtn" style="width: 100%;">Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ± Ù…Ø®ØµØµ</button>
            </div>
            <button class="btn" id="closeDhikrModalBtn" style="width: 100%;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
    
    <!-- Language Modal -->
    <div class="modal" id="langModal">
        <div class="modal-content">
            <h2 class="section-title" id="chooseLangTitle">Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©</h2>
            <div class="dhikr-options"> 
                <div class="lang-option selected" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                <div class="lang-option" data-lang="en">English</div>
            </div>
            <button class="btn" id="closeLangBtn" style="width: 100%; margin-top: 15px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
    
    <!-- Info Modal -->
    <div class="modal" id="infoModal">
        <div class="modal-content">
            <h3 class="section-title" id="infoAppTitle">Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©</h3>
            <p id="infoWelcomeText1">Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ØªØ³Ø¨ÙŠØ­ Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰...</p>
            <p id="infoWelcomeText2">(Ø§Ù„Ø°Ø§ÙƒØ±ÙŠÙ† Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙƒÙØ«ÙÙŠØ±Ù‹Ø§ ÙˆÙØ§Ù„Ø°ÙÙ‘Ø§ÙƒÙØ±ÙØ§ØªÙ...)</p>
            <h3 class="section-title" id="infoUsageTitle">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h3>
            <p id="infoUsageP1">1. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.</p><p id="infoUsageP2">2. Ø§Ø¶ØºØ· âœï¸ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø°ÙƒØ±.</p>
            <p id="infoUsageP3">3. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.</p><p id="infoUsageP4">4. Ø¹Ù†Ø¯ Ø§Ù„Ù…Ù„ÙŠØ§Ø±ØŒ ÙŠØ¹Ø§Ø¯ Ø§Ù„Ø¹Ø¯Ø§Ø¯.</p>
            <h3 class="section-title" id="infoPrivacyTitle">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h3>
            <!-- MODIFIED: Replaced p tags with a div for full policy -->
            <div class="terms-text" id="infoModalPolicyContent" style="max-height: 150px;">
                <!-- Policy content will be injected by JavaScript -->
            </div>
            <h3 class="section-title" id="infoContactTitle">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h3>
            <p id="infoContactText1">Ù„Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª: Billionapp@proton.me</p>
            <button class="btn" id="closeInfoBtn" style="width: 100%; margin-top: 15px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
    
    <audio id="clickSound" preload="auto"><source src="https://audio.jukehost.co.uk/ruYoswMwfnS91z2dYrPsRKQ7kTkYpjDS" type="audio/mpeg"></audio>
    <audio id="resetSound" preload="auto"><source src="https://audio.jukehost.co.uk/4gI1qQlmcopXf0oqiHE3mnabYsL9T4j8" type="audio/mpeg"></audio>
    <audio id="completeSound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3" type="audio/mpeg"></audio>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM Loaded. Initializing Billion Tasbeeh App."); // DEBUG
            const counterElement = document.getElementById('counter');
            const mainButton = document.getElementById('mainButton');
            const currentDhikrElement = document.getElementById('currentDhikr');
            const progressBar = document.getElementById('progressBar');
            
            const clickSound = document.getElementById('clickSound');
            const resetSound = document.getElementById('resetSound');
            const completeSound = document.getElementById('completeSound');
            
            const welcomeModal = document.getElementById('welcomeModal');
            const acceptBtn = document.getElementById('acceptBtn');
            const declineBtn = document.getElementById('declineBtn');
            const welcomeLangArBtn = document.getElementById('welcomeLangAr');
            const welcomeLangEnBtn = document.getElementById('welcomeLangEn');
            const welcomeTermsSection = document.getElementById('welcomeTermsSection');
            const initialDhikrSelectionSection = document.getElementById('initialDhikrSelectionSection');
            const initialDhikrOptionsContainer = document.getElementById('initialDhikrOptionsContainer');
            const initialDhikrTitle = document.getElementById('initialDhikrTitle'); 
            const canChangeLaterText = document.getElementById('canChangeLaterText'); 
            const welcomePolicyContent = document.getElementById('welcomePolicyContent');
            
            const dhikrModal = document.getElementById('dhikrModal');
            const customDhikrInput = document.getElementById('customDhikrInput');
            const addCustomDhikrBtn = document.getElementById('addCustomDhikrBtn');
            const dhikrOptionsContainer = dhikrModal.querySelector('.dhikr-options');
            const langModal = document.getElementById('langModal');
            const infoModal = document.getElementById('infoModal');
            
            const soundBtn = document.getElementById('soundBtn');
            const vibrationBtn = document.getElementById('vibrationBtn');
            const resetBtn = document.getElementById('resetBtn');
            const infoBtn = document.getElementById('infoBtn');
            const editDhikrBtn = document.getElementById('editDhikr');
            const themeBtn = document.getElementById('themeBtn');
            const langBtn = document.getElementById('langBtn');
            
            const textElementIds = {
                appTitle: 'appTitle', mainButtonText: 'mainButton', 
                welcomeTitle: 'welcomeTitle', welcomeText: 'welcomeText', welcomeTermsTitle: 'welcomeTermsTitle',
                welcomePolicyContent: 'welcomePolicyContent', 
                acceptBtnText: 'acceptBtn', declineBtnText: 'declineBtn',
                initialDhikrTitle: 'initialDhikrTitle', canChangeLaterText: 'canChangeLaterText', 
                chooseDhikrTitle: 'chooseDhikrTitle', customDhikrInputPlaceholder: 'customDhikrInput', 
                addCustomDhikrBtnText: 'addCustomDhikrBtn', closeDhikrModalBtnText: 'closeDhikrModalBtn',
                chooseLangTitle: 'chooseLangTitle', closeLangBtnText: 'closeLangBtn',
                infoAppTitle: 'infoAppTitle', infoWelcomeText1: 'infoWelcomeText1', infoWelcomeText2: 'infoWelcomeText2',
                infoUsageTitle: 'infoUsageTitle', infoUsageP1: 'infoUsageP1', infoUsageP2: 'infoUsageP2', infoUsageP3: 'infoUsageP3', infoUsageP4: 'infoUsageP4',
                infoPrivacyTitle: 'infoPrivacyTitle', 
                infoModalPolicyContent: 'infoModalPolicyContent', // ADDED for Info Modal policy
                infoContactTitle: 'infoContactTitle', infoContactText1: 'infoContactText1', closeInfoBtnText: 'closeInfoBtn',
            };
            
            let welcomeModalLanguage = 'ar';

            const appSettings = {
                count: 1000000000, soundEnabled: true, vibrationEnabled: true, darkMode: false,
                language: 'ar',
                dhikr: null, 
                dhikrInitialChoiceMade: false, 
                dhikrList: ["DHIKR_SUBHANALLAH", "DHIKR_ALHAMDULILLAH", "DHIKR_ALLAHUAKBAR", "DHIKR_LAILAHAILLALLAH", "DHIKR_ASTAGHFIRULLAH"],
                translations: {
                    ar: {
                        appTitle: "Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©", mainButtonText: "Ø§Ø¶ØºØ· Ù„Ù„Ø°ÙƒØ±",
                        welcomeTitle: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©",
                        // MODIFIED: Added span with red color
                        welcomeText: "<span style='color: red;'>Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ØªØ³Ø¨ÙŠØ­ Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰ ÙˆØ§Ù„Ù…Ù‚ØµÙˆØ¯ Ø¨Ø§Ù„Ù…Ù„ÙŠØ§Ø± Ø§Ù„ÙƒØ«Ø±Ø© Ù„Ø§ Ø§Ù„ØªÙ‚ÙŠÙŠØ¯ Ø¨Ø§Ù„Ø¹Ø¯Ø¯ Ù„Ù‚ÙˆÙ„Ù‡ ØªØ¹Ø§Ù„Ù‰ (Ø§Ù„Ø°ÙÙ‘Ø§ÙƒÙØ±ÙÙŠÙ†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙƒÙØ«ÙÙŠØ±Ù‹Ø§ ÙˆÙØ§Ù„Ø°ÙÙ‘Ø§ÙƒÙØ±ÙØ§ØªÙ Ø£ÙØ¹ÙØ¯ÙÙ‘ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù„ÙÙ‡ÙÙ… Ù…ÙÙ‘ØºÙ’ÙÙØ±ÙØ©Ù‹ ÙˆÙØ£ÙØ¬Ù’Ø±Ù‹Ø§ Ø¹ÙØ¸ÙÙŠÙ…Ù‹Ø§) [Ø§Ù„Ø£Ø­Ø²Ø§Ø¨:35]. ÙˆØ¬Ø¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡.</span>",
                        welcomeTermsTitle: "Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø´Ø±ÙˆØ·",
                        welcomeFullPolicyText: `
                            <h3>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ù„ØªØ·Ø¨ÙŠÙ‚ "Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©"</h3>
                            <p><em>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: 10 ÙŠÙˆÙ†ÙŠÙˆ 2024</em></p>
                            <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ <strong>"Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©"</strong>. Ù†Ø­Ù† Ù†Ù‚Ø¯Ø± Ø®ØµÙˆØµÙŠØªÙƒÙ… ÙˆÙ†Ù„ØªØ²Ù… Ø¨Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒÙ…. ØªÙˆØ¶Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© ÙƒÙŠÙ Ù†ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙŠØªÙ… Ø¬Ù…Ø¹Ù‡Ø§ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</p>
                            <h4>1. Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙŠ Ù†Ø¬Ù…Ø¹Ù‡Ø§</h4>
                            <p>ØªØ·Ø¨ÙŠÙ‚ <strong>"Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©"</strong> <strong>Ù„Ø§ ÙŠØ¬Ù…Ø¹ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ©</strong>ØŒ Ù…Ø«Ù„:</p>
                            <ul><li>Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</li><li>Ø¨ÙŠØ§Ù†Ø§Øª GPS Ø£Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹</li><li>Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² (IMEIØŒ Ø¹Ù†ÙˆØ§Ù† IP)</li></ul>
                            <p>ÙˆÙ…Ø¹ Ø°Ù„ÙƒØŒ Ù‚Ø¯ Ù†Ø³ØªØ®Ø¯Ù… Ø®Ø¯Ù…Ø§Øª Ø·Ø±Ù Ø«Ø§Ù„Ø« Ù…Ø«Ù„ <strong>Google AdMob</strong> (Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª)ØŒ ÙˆØ§Ù„ØªÙŠ Ù‚Ø¯ ØªØ¬Ù…Ø¹ <strong>Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø´Ø®ØµÙŠØ©</strong> Ù„Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ÙˆØªØ®ØµÙŠØµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª. ÙŠØªÙ… Ø°Ù„Ùƒ ÙˆÙÙ‚Ù‹Ø§ Ù„Ø³ÙŠØ§Ø³Ø§Øª Google Ø§Ù„Ø®Ø§ØµØ©.</p>
                            <h4>2. ÙƒÙŠÙ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h4>
                            <p>Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø´Ø®ØµÙŠØ© ÙŠØªÙ… Ø¬Ù…Ø¹Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù„Ø« (Ù…Ø«Ù„ AdMob) Ù‚Ø¯ ØªÙØ³ØªØ®Ø¯Ù…:</p>
                            <ul><li>Ù„ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„.</li><li>Ù„Ø¹Ø±Ø¶ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø°Ø§Øª ØµÙ„Ø© (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹).</li></ul>
                            <p>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù†ÙØ³Ù‡ Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø£ØºØ±Ø§Ø¶ Ø£Ø®Ø±Ù‰.</p>
                            <h4>3. Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø£Ø·Ø±Ø§Ù Ø«Ø§Ù„Ø«Ø©</h4>
                            <p>Ù†Ø­Ù† <strong>Ù„Ø§ Ù†Ø¨ÙŠØ¹ Ø£Ùˆ Ù†Ø´Ø§Ø±Ùƒ</strong> Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ­Ø¯Ø¯ Ù‡ÙˆÙŠØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù…Ø¹ Ø¬Ù‡Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©ØŒ Ù„Ø£Ù†Ù†Ø§ Ù„Ø§ Ù†Ø¬Ù…Ø¹Ù‡Ø§ Ø£ØµÙ„Ø§Ù‹. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ØªØ¬Ù…Ø¹Ù‡Ø§ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù„Ø« Ù…Ø«Ù„ Google AdMob ØªØ®Ø¶Ø¹ Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ù….</p>
                            <ul><li><strong>Ù…Ù‚Ø¯Ù…Ùˆ Ø§Ù„Ø®Ø¯Ù…Ø§Øª:</strong> Ù…Ø«Ù„ Google AdMob (Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§).</li><li><strong>Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©:</strong> Ù‚Ø¯ Ù†ÙƒØ´Ù Ø¹Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø°Ø§ Ø·ÙÙ„Ø¨ Ù…Ù†Ø§ Ø°Ù„Ùƒ Ø¨Ù…ÙˆØ¬Ø¨ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†.</li></ul>
                            <h4>4. ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                            <ul><li>Ù„Ø§ ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</li><li>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù…Ø«Ù„ Ø¹Ø¯Ø¯ Ø§Ù„ØªØ³Ø¨ÙŠØ­Ø§ØªØŒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø°ÙƒØ±ØŒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ø§Ù‡ØªØ²Ø§Ø²ØŒ Ø§Ù„Ù„ØºØ©ØŒ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†) ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ <strong>Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø·</strong> Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ®Ø²ÙŠÙ† Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ù„ÙŠ (LocalStorage). Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§ ØªÙÙ†Ù‚Ù„ Ø¥Ù„Ù‰ Ø£ÙŠ Ø®Ø§Ø¯Ù….</li></ul>
                            <h4>5. Ø­Ù‚ÙˆÙ‚Ùƒ</h4>
                            <ul><li>Ø¨Ù…Ø§ Ø£Ù†Ù†Ø§ Ù„Ø§ Ù†Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ©ØŒ ÙÙ„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ© Ù„ØªØ·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ø£Ùˆ ØªØµØ­ÙŠØ­Ù‡Ø§ Ø£Ùˆ Ø­Ø°ÙÙ‡Ø§ Ù…Ù† Ø¬Ø§Ù†Ø¨Ù†Ø§.</li><li>ÙŠÙ…ÙƒÙ†Ùƒ <strong>Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</strong> ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ù„Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ.</li><li>ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØµÙØ­ Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙˆÙŠØ¨ Ù‡Ø°Ø§ (Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ³ØªØ®Ø¯Ù…Ù‡ ÙƒÙ€ PWA) Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§.</li><li>Ù„Ø£ÙŠØ© Ù…Ø®Ø§ÙˆÙ ØªØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ø®ØµÙˆØµÙŠØ©ØŒ Ø£Ùˆ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø¯ÙŠÙƒ Ø£Ø³Ø¦Ù„Ø© Ø­ÙˆÙ„ ÙƒÙŠÙÙŠØ© ØªØ¹Ø§Ù…Ù„ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù„Ø« Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø§ ÙˆØ³Ù†ÙˆØ¬Ù‡Ùƒ Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù† Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³ÙŠØ§Ø³Ø§ØªÙ‡Ù… Ù…Ø¨Ø§Ø´Ø±Ø©.</li></ul>
                            <h4>6. Ø£Ù…Ø§Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                            <p>Ù†Ø­Ù† Ù†ØªØ®Ø° ØªØ¯Ø§Ø¨ÙŠØ± Ù…Ø¹Ù‚ÙˆÙ„Ø© Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ùˆ Ø§Ù„ÙƒØ´Ù ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡ØŒ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØºÙ… Ù…Ù† Ø£Ù†Ù‡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù„Ø£ÙŠ Ù†Ø¸Ø§Ù… Ø£Ù† ÙŠÙƒÙˆÙ† Ø¢Ù…Ù†Ù‹Ø§ ØªÙ…Ø§Ù…Ù‹Ø§.</p>
                            <h4>7. Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ø£Ø·ÙØ§Ù„</h4>
                            <p>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø®ØµØµ Ù„Ø¬Ù…Ù‡ÙˆØ± Ø¹Ø§Ù… ÙˆÙ„Ø§ ÙŠØ³ØªÙ‡Ø¯Ù Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ø°ÙŠÙ† ØªÙ‚Ù„ Ø£Ø¹Ù…Ø§Ø±Ù‡Ù… Ø¹Ù† 13 Ø¹Ø§Ù…Ù‹Ø§ (Ø£Ùˆ Ø§Ù„Ø³Ù† Ø§Ù„Ù…ÙƒØ§ÙØ¦ ÙÙŠ Ø§Ù„ÙˆÙ„Ø§ÙŠØ© Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ© Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©). Ù†Ø­Ù† Ù„Ø§ Ù†Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø®ØµÙŠØ© Ø¹Ù† Ø¹Ù„Ù… Ù…Ù† Ø§Ù„Ø£Ø·ÙØ§Ù„.</p>
                            <h4>8. ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø³Ø©</h4>
                            <p>Ù‚Ø¯ Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ù…Ù† ÙˆÙ‚Øª Ù„Ø¢Ø®Ø±. Ø³ÙŠØªÙ… Ù†Ø´Ø± Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø¹ ØªØ§Ø±ÙŠØ® "Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«" Ù…Ø¹Ø¯Ù„. Ù†Ø´Ø¬Ø¹Ùƒ Ø¹Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ù‡Ø°Ù‡ Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ.</p>
                            <h4>9. Ø§ØªØµÙ„ Ø¨Ù†Ø§</h4>
                            <p>Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø£Ø³Ø¦Ù„Ø© Ø­ÙˆÙ„ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ù‡Ø°Ù‡:</p>
                            < <p>ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: Billionapp@proton.me</p>
                            
                        `,
                        acceptBtnText: "Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·", declineBtnText: "Ø±ÙØ¶",
                        initialDhikrTitle: "Ø§Ø®ØªØ± Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ø°ÙŠ Ø³ØªØ±Ø¯Ø¯Ù‡", canChangeLaterText: "ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø°ÙƒØ± Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.",
                        chooseDhikrTitle: "Ø§Ø®ØªØ± Ø§Ù„Ø°ÙƒØ±", customDhikrInputPlaceholder: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø°ÙƒØ± Ù‡Ù†Ø§...", addCustomDhikrBtnText: "Ø¥Ø¶Ø§ÙØ© Ø°ÙƒØ± Ù…Ø®ØµØµ", closeDhikrModalBtnText: "Ø¥ØºÙ„Ø§Ù‚",
                        chooseLangTitle: "Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©", closeLangBtnText: "Ø¥ØºÙ„Ø§Ù‚",
                        infoAppTitle: "Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©", infoWelcomeText1: "Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ØªØ³Ø¨ÙŠØ­ Ø§Ù„Ù„Ù‡ ØªØ¹Ø§Ù„Ù‰ØŒ ÙˆØ§Ù„Ù…Ù‚ØµÙˆØ¯ Ø¨Ø§Ù„Ù…Ù„ÙŠØ§Ø± Ø§Ù„ÙƒØ«Ø±Ø©.", infoWelcomeText2: "(Ø§Ù„Ø°ÙÙ‘Ø§ÙƒÙØ±ÙÙŠÙ†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙƒÙØ«ÙÙŠØ±Ù‹Ø§ ÙˆÙØ§Ù„Ø°ÙÙ‘Ø§ÙƒÙØ±ÙØ§ØªÙ...)",
                        infoUsageTitle: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…", infoUsageP1: "1. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ÙƒÙ„ ØªØ³Ø¨ÙŠØ­Ø©.", infoUsageP2: "2. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ âœï¸ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø°ÙƒØ±.",
                        infoUsageP3: "3. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.", infoUsageP4: "4. Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…Ù„ÙŠØ§Ø±ØŒ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.",
                        infoPrivacyTitle: "Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©", // Title for policy in Info Modal
                        infoContactTitle: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§", infoContactText1: "Ù„Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª: <Billionapp@proton.me\">Billionapp@proton.me</a>", closeInfoBtnText: "Ø¥ØºÙ„Ø§Ù‚",
                        resetConfirm: "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¥Ù„Ù‰ Ù…Ù„ÙŠØ§Ø±ØŸ", congrats: "Ù…Ø¨Ø§Ø±Ùƒ! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©!",
                        dhikrExists: "Ø§Ù„Ø°ÙƒØ± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„!", enterValidDhikr: "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø°ÙƒØ± ØµØ­ÙŠØ­.", mustAcceptTerms: "Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.",
                        DHIKR_SUBHANALLAH: "Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù", DHIKR_ALHAMDULILLAH: "Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù", DHIKR_ALLAHUAKBAR: "Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù",
                        DHIKR_LAILAHAILLALLAH: "Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù", DHIKR_ASTAGHFIRULLAH: "Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù"
                    },
                    en: {
                        appTitle: "Billion Tasbeeh", mainButtonText: "Press for Dhikr",
                        welcomeTitle: "Welcome to Billion Tasbeeh",
                        // MODIFIED: Added span with red color
                        welcomeText: "<span style='color: red;'>This app helps you in the remembrance of Allah. The term 'Billion' (Ù…Ù„ÙŠØ§Ø±) signifies abundance, not a strict numerical target, inspired by the Quranic emphasis on remembering Allah often: (Indeed, the men who remember Allah often and the women who do so - for them Allah has prepared forgiveness and a great reward) [Al-Ahzab 33:35]. This is for clarification.</span>",
                        welcomeTermsTitle: "Privacy Policy and Terms",
                        welcomeFullPolicyText: `
                            <h3>Privacy Policy for "Billion Tasbeeh" App</h3>
                            <p><em>Last Updated: June 10, 2024</em></p>
                            <p>Welcome to <strong>"Billion Tasbeeh"</strong> (in Arabic: "Ù…Ù„ÙŠØ§Ø± ØªØ³Ø¨ÙŠØ­Ø©"). We value your privacy and are committed to protecting your data. This policy explains how we handle any information collected through the app.</p>
                            <h4>1. Information We Collect</h4>
                            <p>The <strong>"Billion Tasbeeh"</strong> app <strong>does NOT collect any personal data</strong>, such as:</p>
                            <ul><li>Name, email, phone number</li><li>GPS or location data</li><li>Device identifiers (IMEI, IP address)</li></ul>
                            <p>However, we may use third-party services like <strong>Google AdMob</strong> (for ads), which may collect <strong>non-personal data</strong> for analytics and ad personalization according to Google's own policies.</p>
                            <h4>2. How We Use Information</h4>
                            <p>Any non-personal data collected by third-party services (like AdMob) may be used:</p>
                            <ul><li>To improve app performance and identify issues.</li><li>To display relevant ads (if the app incorporates ads in the future).</li></ul>
                            <p>The app itself does not use any data for other purposes.</p>
                            <h4>3. Data Sharing with Third Parties</h4>
                            <p>We <strong>do not sell or share</strong> any personally identifiable information with external parties, because we do not collect it in the first place. Data collected by third-party services like Google AdMob is subject to their respective privacy policies.</p>
                            <ul><li><strong>Service Providers:</strong> Such as Google AdMob (for ad analytics and serving).</li><li><strong>Legal Requirements:</strong> We may disclose information if required by law.</li></ul>
                            <h4>4. Data Storage</h4>
                            <ul><li>No personal data is stored by the app.</li><li>App settings (such as tasbeeh counts, selected Dhikr, sound/vibration settings, language, dark mode) are saved <strong>locally on your device only</strong> using Web LocalStorage. This data is not transmitted to any server.</li></ul>
                            <h4>5. Your Rights</h4>
                            <ul><li>As we do not collect personal data, there is no personal data for you to access, correct, or delete from our side.</li><li>You can <strong>uninstall the app</strong> at any time to remove all locally stored settings on your device.</li><li>You can clear browsing data for this website (if using as a PWA) to remove locally stored data.</li><li>For any privacy concerns, or if you have questions about how third-party services handle your data, you can contact us, and we will guide you as best as possible, or you can review their policies directly.</li></ul>
                            <h4>6. Data Security</h4>
                            <p>We take reasonable measures to protect information stored locally on your device from unauthorized access, use, or disclosure, although no system can be completely secure.</p>
                            <h4>7. Children's Privacy</h4>
                            <p>The app is intended for a general audience and does not target children under the age of 13 (or the equivalent age in the relevant jurisdiction). We do not knowingly collect personal information from children.</p>
                            <h4>8. Policy Changes</h4>
                            <p>We may update this policy from time to time. Any changes will be posted on this page with a revised "Last Updated" date. We encourage you to review this Privacy Policy periodically.</p>
                            <h4>9. Contact Us</h4>
                            <p>If you have any questions about this Privacy Policy:</p>
                            <p>ğŸ“§ Email: Billionapp@proton.me</p>
                          
                        `,
                        acceptBtnText: "I Accept the Terms", declineBtnText: "Decline",
                        initialDhikrTitle: "Choose the Dhikr you will recite", canChangeLaterText: "You can change the Dhikr later from settings.",
                        chooseDhikrTitle: "Choose Dhikr", customDhikrInputPlaceholder: "Enter custom dhikr...", addCustomDhikrBtnText: "Add Custom Dhikr", closeDhikrModalBtnText: "Close",
                        chooseLangTitle: "Choose Language", closeLangBtnText: "Close",
                        infoAppTitle: "Billion Tasbeeh", infoWelcomeText1: "This app helps you in the remembrance of Allah, 'Billion' signifies abundance.", infoWelcomeText2: "(Indeed, the men who remember Allah often...)",
                        infoUsageTitle: "How to Use", infoUsageP1: "1. Press the main button for each tasbeeh.", infoUsageP2: "2. Press âœï¸ to change the Dhikr.",
                        infoUsageP3: "3. Use the bottom buttons to control settings.", infoUsageP4: "4. When one billion is completed, the counter will reset automatically.",
                        infoPrivacyTitle: "Privacy Policy", // Title for policy in Info Modal
                        infoContactTitle: "Contact Us", infoContactText1: "For suggestions or inquiries: <a :Billionapp@proton.me\">Billionapp@proton.me</a>", closeInfoBtnText: "Close",
                        resetConfirm: "Are you sure you want to reset the counter to one billion?", congrats: "Congratulations! You have completed one billion tasbeehs!",
                        dhikrExists: "Dhikr already exists!", enterValidDhikr: "Please enter a valid dhikr.", mustAcceptTerms: "Sorry, you must accept the terms to use the app.",
                        DHIKR_SUBHANALLAH: "SubhanAllah", DHIKR_ALHAMDULILLAH: "Alhamdulillah", DHIKR_ALLAHUAKBAR: "Allahu Akbar",
                        DHIKR_LAILAHAILLALLAH: "La ilaha illAllah", DHIKR_ASTAGHFIRULLAH: "Astaghfirullah"
                    }
                },
                welcomeShown: false
            };

            function getDisplayDhikr(dhikrIdentifier, lang) {
                const currentLangTranslations = appSettings.translations[lang];
                if (currentLangTranslations && currentLangTranslations[dhikrIdentifier]) {
                    return currentLangTranslations[dhikrIdentifier];
                }
                return dhikrIdentifier;
            }

            function loadSettings() {
                console.log("loadSettings: Attempting to load settings from localStorage."); // DEBUG
                const savedSettings = localStorage.getItem('tasbeehSettings');
                if (savedSettings) {
                    console.log("loadSettings: Found saved settings:", savedSettings); // DEBUG
                    const settings = JSON.parse(savedSettings);
                    appSettings.count = settings.count !== undefined ? settings.count : 1000000000;
                    appSettings.soundEnabled = settings.soundEnabled !== undefined ? settings.soundEnabled : true;
                    appSettings.vibrationEnabled = settings.vibrationEnabled !== undefined ? settings.vibrationEnabled : true;
                    appSettings.darkMode = settings.darkMode !== undefined ? settings.darkMode : false;
                    appSettings.language = settings.language || 'ar';
                    appSettings.dhikr = settings.dhikr || null;
                    appSettings.dhikrInitialChoiceMade = settings.dhikrInitialChoiceMade || false;

                    const defaultDhikrKeys = ["DHIKR_SUBHANALLAH", "DHIKR_ALHAMDULILLAH", "DHIKR_ALLAHUAKBAR", "DHIKR_LAILAHAILLALLAH", "DHIKR_ASTAGHFIRULLAH"];
                    if (settings.dhikrList) {
                        appSettings.dhikrList = [...new Set([...defaultDhikrKeys, ...settings.dhikrList.filter(d => !defaultDhikrKeys.includes(d) || typeof d === 'string')])];
                    } else {
                        appSettings.dhikrList = defaultDhikrKeys;
                    }
                    if (appSettings.dhikr && !appSettings.dhikrInitialChoiceMade) { 
                        appSettings.dhikrInitialChoiceMade = true; 
                        console.log("loadSettings: Marked dhikrInitialChoiceMade as true for compatibility."); 
                    }
                    if (appSettings.dhikrInitialChoiceMade && appSettings.dhikr === null) { 
                        console.warn("loadSettings: dhikrInitialChoiceMade is true, but dhikr is null. Forcing re-selection."); 
                        appSettings.dhikrInitialChoiceMade = false; 
                    }
                    appSettings.welcomeShown = settings.welcomeShown || false;
                } else {
                    console.log("loadSettings: No saved settings found. Using defaults."); 
                }

                console.log("loadSettings: Final pre-load state: welcomeShown =", appSettings.welcomeShown, "dhikrInitialChoiceMade =", appSettings.dhikrInitialChoiceMade, "dhikr =", appSettings.dhikr, "language =", appSettings.language); 

                welcomeModalLanguage = appSettings.language;
                updateCounter();
                updateSettingsButtons();
                applyTheme();
                applyLanguage(); // This will also apply language to welcome modal if shown

                if (!appSettings.welcomeShown || !appSettings.dhikrInitialChoiceMade) {
                    console.log("loadSettings: Welcome modal conditions met. Displaying welcomeModal."); 
                    welcomeModal.style.display = 'flex';
                     applyWelcomeModalLanguage(welcomeModalLanguage); // Ensure welcome modal text is set
                    if (appSettings.welcomeShown && !appSettings.dhikrInitialChoiceMade) {
                        console.log("loadSettings: Terms accepted, but no initial dhikr. Showing dhikr selection."); 
                        showInitialDhikrSelection();
                    } else {
                        console.log("loadSettings: Showing terms section."); 
                        welcomeTermsSection.style.display = 'block';
                        initialDhikrSelectionSection.style.display = 'none';
                    }
                } else if (appSettings.dhikr) {
                     console.log("loadSettings: Welcome process complete. Updating Dhikr display with:", appSettings.dhikr); 
                     updateDhikrDisplay();
                } else {
                    console.warn("loadSettings: Welcome complete but no dhikr set. This should ideally not happen."); 
                }
            }

            function saveSettings() {
                console.log("saveSettings: Saving settings to localStorage:", JSON.stringify(appSettings)); 
                localStorage.setItem('tasbeehSettings', JSON.stringify(appSettings));
            }

            function updateCounter() {
                const formattedCount = appSettings.count.toLocaleString();
                counterElement.textContent = formattedCount;
                const progress = ((1000000000 - appSettings.count) / 1000000000) * 100;
                progressBar.style.width = progress + '%';
                let counterColor;
                if (appSettings.count <= 0) {
                    counterColor = '#27ae60';
                    if (!document.body.classList.contains('completed-message-shown')) {
                        showCompletionMessage();
                        document.body.classList.add('completed-message-shown');
                    }
                } else if (appSettings.count <= 100000000) counterColor = '#e74c3c';
                else if (appSettings.count <= 500000000) counterColor = '#f39c12';
                else if (appSettings.count <= 900000000) counterColor = '#3498db';
                else counterColor = appSettings.darkMode ? 'var(--counter-color)' : 'var(--counter-color)';
                counterElement.style.color = counterColor;
            }

            function showCompletionMessage() {
                if (appSettings.soundEnabled) { completeSound.currentTime = 0; completeSound.play(); }
                alert(appSettings.translations[appSettings.language].congrats);
                setTimeout(() => {
                    appSettings.count = 1000000000; updateCounter(); saveSettings();
                    document.body.classList.remove('completed-message-shown');
                }, 2000);
            }
            
            function updateDhikrDisplay() {
                console.log("updateDhikrDisplay: Updating. Current appSettings.dhikr:", appSettings.dhikr, "Language:", appSettings.language); 
                if (appSettings.dhikr) {
                    currentDhikrElement.textContent = getDisplayDhikr(appSettings.dhikr, appSettings.language);
                } else {
                    currentDhikrElement.textContent = appSettings.translations[appSettings.language].chooseDhikrTitle || "Choose Dhikr"; 
                    console.log("updateDhikrDisplay: No dhikr selected, showing placeholder."); 
                }
                
                dhikrOptionsContainer.innerHTML = '';
                appSettings.dhikrList.forEach(dhikrId => {
                    const option = document.createElement('div');
                    option.classList.add('dhikr-option');
                    option.dataset.dhikr = dhikrId;
                    option.textContent = getDisplayDhikr(dhikrId, appSettings.language);
                    if (dhikrId === appSettings.dhikr) option.classList.add('selected');
                    option.addEventListener('click', function() {
                        selectDhikr(this.dataset.dhikr);
                        dhikrModal.style.display = 'none';
                    });
                    dhikrOptionsContainer.appendChild(option);
                });
            }

            function populateInitialDhikrOptions() {
                console.log("populateInitialDhikrOptions called. Current welcome modal language:", welcomeModalLanguage); 
                initialDhikrOptionsContainer.innerHTML = '';
                const currentLang = welcomeModalLanguage; 
                const trans = appSettings.translations[currentLang];

                if (initialDhikrTitle) initialDhikrTitle.textContent = trans.initialDhikrTitle;
                if (canChangeLaterText) canChangeLaterText.textContent = trans.canChangeLaterText;

                appSettings.dhikrList.forEach(dhikrId => {
                    if (dhikrId.startsWith("DHIKR_")) { 
                        const option = document.createElement('div');
                        option.classList.add('dhikr-option');
                        option.dataset.dhikr = dhikrId;
                        option.textContent = getDisplayDhikr(dhikrId, currentLang);
                        option.addEventListener('click', function() {
                            console.log("Initial Dhikr option clicked:", this.dataset.dhikr); 
                            appSettings.dhikr = this.dataset.dhikr;
                            appSettings.dhikrInitialChoiceMade = true;
                            appSettings.welcomeShown = true; 
                            appSettings.language = welcomeModalLanguage;
                            saveSettings();
                            applyLanguage(); 
                            welcomeModal.style.display = 'none';
                            console.log("Initial Dhikr selected. Welcome modal closed. App language set to:", appSettings.language); 
                            playClickSound();
                        });
                        initialDhikrOptionsContainer.appendChild(option);
                    }
                });
            }

            function showInitialDhikrSelection() {
                console.log("showInitialDhikrSelection called. welcomeModalLanguage:", welcomeModalLanguage); 
                applyWelcomeModalLanguage(welcomeModalLanguage);
                populateInitialDhikrOptions();
                welcomeTermsSection.style.display = 'none';
                initialDhikrSelectionSection.style.display = 'block';
                console.log("Initial Dhikr Selection Section should be visible now."); 
            }

            function applyLanguage() {
                console.log("applyLanguage: Applying language:", appSettings.language); 
                const lang = appSettings.language;
                const trans = appSettings.translations[lang];
                document.documentElement.lang = lang;
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

                for (const key in textElementIds) {
                    const elId = textElementIds[key];
                    const el = document.getElementById(elId);
                    if (el && trans[key] !== undefined) {
                        if (key.endsWith('Placeholder')) {
                            el.placeholder = trans[key];
                        } else if (elId === 'welcomePolicyContent') { 
                            el.innerHTML = trans.welcomeFullPolicyText; // Use the full policy text key
                        } else if (elId === 'infoModalPolicyContent') { // MODIFIED: Handle info modal policy
                            el.innerHTML = trans.welcomeFullPolicyText; // Reuse the same full policy text
                        } else if (['BUTTON', 'SPAN', 'H1', 'H2', 'H3', 'P'].includes(el.tagName) || key.endsWith('Text')) {
                             if (['welcomeText', 'infoWelcomeText1', 'infoWelcomeText2', 'infoContactText1', 'initialDhikrTitle', 'canChangeLaterText'].includes(elId) || key === 'welcomeText') {
                                el.innerHTML = trans[key];
                            } else {
                                el.textContent = trans[key];
                            }
                        }
                    } else if (el && elId === 'welcomePolicyContent' && trans.welcomeFullPolicyText) { // Fallback for welcomePolicyContent if key doesn't match but translation exists
                         el.innerHTML = trans.welcomeFullPolicyText;
                    } else if (el && elId === 'infoModalPolicyContent' && trans.welcomeFullPolicyText) { // Fallback for infoModalPolicyContent
                         el.innerHTML = trans.welcomeFullPolicyText;
                    }
                }
                updateDhikrDisplay(); 
                document.querySelectorAll('.lang-option').forEach(opt => opt.classList.toggle('selected', opt.dataset.lang === lang));
                
                if (welcomeModal.style.display === 'flex') {
                     applyWelcomeModalLanguage(appSettings.language); 
                     if (initialDhikrSelectionSection.style.display === 'block') { 
                        console.log("applyLanguage: Initial dhikr selection visible, re-populating options."); 
                        populateInitialDhikrOptions(); 
                    }
                }
            }

            function applyWelcomeModalLanguage(lang) {
                console.log("applyWelcomeModalLanguage: Setting welcome modal language to:", lang); 
                welcomeModalLanguage = lang; 
                const trans = appSettings.translations[lang];
                const modalContent = welcomeModal.querySelector('.modal-content');
                if (modalContent) { 
                    modalContent.lang = lang;
                    modalContent.dir = lang === 'ar' ? 'rtl' : 'ltr';
                }

                if (document.getElementById('welcomeTitle')) document.getElementById('welcomeTitle').textContent = trans.welcomeTitle;
                if (document.getElementById('welcomeText')) document.getElementById('welcomeText').innerHTML = trans.welcomeText; // Uses innerHTML due to span
                if (document.getElementById('welcomeTermsTitle')) document.getElementById('welcomeTermsTitle').textContent = trans.welcomeTermsTitle;
                if (welcomePolicyContent) welcomePolicyContent.innerHTML = trans.welcomeFullPolicyText;

                if (document.getElementById('acceptBtn')) document.getElementById('acceptBtn').textContent = trans.acceptBtnText;
                if (document.getElementById('declineBtn')) document.getElementById('declineBtn').textContent = trans.declineBtnText;
                
                if (initialDhikrTitle) initialDhikrTitle.textContent = trans.initialDhikrTitle;
                if (canChangeLaterText) canChangeLaterText.textContent = trans.canChangeLaterText;

                if (welcomeLangArBtn && welcomeLangEnBtn) {
                    welcomeLangArBtn.classList.toggle('selected', lang === 'ar');
                    welcomeLangEnBtn.classList.toggle('selected', lang === 'en');
                }
            }

            function applyTheme() {
                document.documentElement.setAttribute('data-theme', appSettings.darkMode ? 'dark' : '');
                themeBtn.textContent = appSettings.darkMode ? 'â˜€ï¸' : 'ğŸŒ™';
                updateCounter();
            }

            function playClickSound() {
                if (appSettings.soundEnabled) { clickSound.currentTime = 0; clickSound.play().catch(e => console.warn("No sound", e)); }
            }
            function toggleSound() { appSettings.soundEnabled = !appSettings.soundEnabled; updateSettingsButtons(); playClickSound(); saveSettings(); }
            function toggleVibration() {
                appSettings.vibrationEnabled = !appSettings.vibrationEnabled; updateSettingsButtons();
                if (appSettings.vibrationEnabled && navigator.vibrate) navigator.vibrate(50);
                saveSettings();
            }
            function toggleTheme() { appSettings.darkMode = !appSettings.darkMode; applyTheme(); saveSettings(); playClickSound(); }
            
            function changeLanguage(lang) {
                console.log("changeLanguage: Changing app language to:", lang); 
                appSettings.language = lang;
                applyLanguage(); 
                saveSettings();
                playClickSound();
            }

            function updateSettingsButtons() {
                soundBtn.textContent = appSettings.soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
                vibrationBtn.textContent = appSettings.vibrationEnabled ? 'ğŸ“³' : 'ğŸ“´';
            }

            function resetCounter() {
                if (confirm(appSettings.translations[appSettings.language].resetConfirm)) {
                    appSettings.count = 1000000000; updateCounter();
                    if (appSettings.vibrationEnabled && navigator.vibrate) navigator.vibrate(100);
                    if (appSettings.soundEnabled) { resetSound.currentTime = 0; resetSound.play(); }
                    saveSettings();
                }
            }

            function selectDhikr(dhikrId) {
                console.log("selectDhikr: Selecting dhikr:", dhikrId); 
                appSettings.dhikr = dhikrId;
                if (!appSettings.dhikrInitialChoiceMade) appSettings.dhikrInitialChoiceMade = true; 
                updateDhikrDisplay();
                saveSettings();
                playClickSound();
            }

            mainButton.addEventListener("click", function() {
                if (!appSettings.dhikr) { 
                    console.warn("Main button clicked, but no dhikr selected. Opening selection modal."); 
                    alert(appSettings.translations[appSettings.language].chooseDhikrTitle);
                    editDhikrBtn.click(); 
                    return;
                }
                if (appSettings.count > 0) {
                    appSettings.count--; updateCounter(); playClickSound();
                    if (appSettings.vibrationEnabled && navigator.vibrate) navigator.vibrate(30);
                    saveSettings();
                } else {
                    if (!document.body.classList.contains('completed-message-shown')) showCompletionMessage();
                }
            });

            addCustomDhikrBtn.addEventListener("click", function() {
                const newDhikr = customDhikrInput.value.trim();
                if (newDhikr) {
                    const isPredefinedKey = !!appSettings.translations[appSettings.language][newDhikr];
                    const alreadyExists = appSettings.dhikrList.includes(newDhikr) || (isPredefinedKey && appSettings.dhikrList.includes(newDhikr));
                    if (!alreadyExists && !isPredefinedKey) {
                        appSettings.dhikrList.push(newDhikr);
                        selectDhikr(newDhikr); customDhikrInput.value = "";
                    } else if (alreadyExists || isPredefinedKey) alert(appSettings.translations[appSettings.language].dhikrExists);
                } else alert(appSettings.translations[appSettings.language].enterValidDhikr);
                playClickSound();
            });

            soundBtn.addEventListener("click", toggleSound);
            vibrationBtn.addEventListener("click", toggleVibration);
            resetBtn.addEventListener("click", resetCounter);
            infoBtn.addEventListener("click", () => { infoModal.style.display = "flex"; playClickSound(); });
            editDhikrBtn.addEventListener("click", () => { updateDhikrDisplay(); dhikrModal.style.display = "flex"; playClickSound(); });
            themeBtn.addEventListener("click", toggleTheme);
            langBtn.addEventListener("click", () => { langModal.style.display = "flex"; playClickSound(); });

            if (welcomeLangArBtn) welcomeLangArBtn.addEventListener('click', () => { 
                console.log("Welcome Lang AR clicked"); 
                applyWelcomeModalLanguage('ar'); 
                if (initialDhikrSelectionSection.style.display === 'block') populateInitialDhikrOptions(); 
            });
            if (welcomeLangEnBtn) welcomeLangEnBtn.addEventListener('click', () => { 
                console.log("Welcome Lang EN clicked"); 
                applyWelcomeModalLanguage('en'); 
                if (initialDhikrSelectionSection.style.display === 'block') populateInitialDhikrOptions(); 
            });

            acceptBtn.addEventListener("click", function() {
                console.log("Accept button clicked. welcomeModalLanguage:", welcomeModalLanguage); 
                appSettings.welcomeShown = true;
                showInitialDhikrSelection();
                playClickSound();
            });

            declineBtn.addEventListener("click", () => { alert(appSettings.translations[welcomeModalLanguage].mustAcceptTerms); playClickSound(); });

            document.getElementById("closeDhikrModalBtn").addEventListener("click", () => { dhikrModal.style.display = "none"; playClickSound(); });
            document.getElementById("closeLangBtn").addEventListener("click", () => { langModal.style.display = "none"; playClickSound(); });
            document.getElementById("closeInfoBtn").addEventListener("click", () => { infoModal.style.display = "none"; playClickSound(); });

            document.querySelectorAll(".lang-option").forEach(option => {
                option.addEventListener("click", function() { changeLanguage(this.dataset.lang); langModal.style.display = "none"; });
            });
            
            loadSettings(); 
            
            function initAudioInteraction() {
                clickSound.volume = 0.01; 
                clickSound.play().then(() => {
                    clickSound.pause(); clickSound.currentTime = 0; clickSound.volume = 1.0;
                }).catch(e => { clickSound.volume = 1.0; }); 
                document.removeEventListener('click', initAudioInteraction);
                document.removeEventListener('touchstart', initAudioInteraction);
            }
            document.addEventListener('click', initAudioInteraction, { once: true });
            document.addEventListener('touchstart', initAudioInteraction, { once: true });
            console.log("Billion Tasbeeh App Initialized."); 
        });
    </script>
</body>
</html>
